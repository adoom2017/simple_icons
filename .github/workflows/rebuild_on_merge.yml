name: "Rebuild on Merge"

on:
  pull_request:
    types: [closed]



jobs:
  merge_job:
    # this job will only run if the PR has been merged
    if: github.event.pull_request.merged == true
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - uses: actions/setup-node@v2
        with:
          node-version: '15.x'

      # Setup the flutter environment.
      - uses: subosito/flutter-action@v1
        with:
          channel: 'beta' # 'dev', 'alpha', default to: 'stable'
          # flutter-version: '1.12.x' # you can also specify exact version of flutter

      - name: Install dependencies
        run: sudo apt install fonttools
        run: sudo snap install yq

      - name: Set Version and Changelog
        run: bash ./set_version.sh
        working-directory: ./tool/
        
      - name: Get Flutter packages
        run: flutter pub get

      - name: Run build script
        run: bash ./build.sh
        working-directory: ./tool/

      - name: Commit new changes
        run: |
          git config user.name github-actions
          git config user.email github-actions@github.com
          git add .
          git commit -m "ðŸ¤– - the font repository was updated"
          git push
        
  close_job:
    # this job will only run if the PR has been closed without being merged
    if: github.event.pull_request.merged == false
    runs-on: ubuntu-latest
    steps:
    - run: |
        echo PR #${{ github.event.number }} has been closed without being merged
